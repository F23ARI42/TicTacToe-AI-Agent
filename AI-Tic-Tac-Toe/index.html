<!DOCTYPE html>
<html>
<head>
	<title>Tic Tac Toe AI</title>
	<style>
		table { border-collapse: collapse; }
		td {
			width: 60px; height: 60px; font-size: 2em;
			text-align: center; border: 1px solid #333;
			cursor: pointer;
		}
	</style>
	 <title>Tic Tac Toe AI</title>
	<link rel="stylesheet" href="Webversion/style.css">
</head>
<body>

<h2>Tic Tac Toe (AI with Difficulty)</h2>

<select id="difficulty-select" onchange="changeDifficulty(this)">
	<option value="easy">Easy</option>
	<option value="medium">Medium</option>
	<option value="hard" selected>Hard</option>
</select>

<br><br>

<table>
	<tbody>
		<tr>
			<td id="00" onclick="clickedCell(this)"></td>
			<td id="01" onclick="clickedCell(this)"></td>
			<td id="02" onclick="clickedCell(this)"></td>
		</tr>
		<tr>
			<td id="10" onclick="clickedCell(this)"></td>
			<td id="11" onclick="clickedCell(this)"></td>
			<td id="12" onclick="clickedCell(this)"></td>
		</tr>
		<tr>
			<td id="20" onclick="clickedCell(this)"></td>
			<td id="21" onclick="clickedCell(this)"></td>
			<td id="22" onclick="clickedCell(this)"></td>
		</tr>
	</tbody>
</table>

<br>
<input id="bnt-restart" type="button" value="Start AI" onclick="restartBnt(this)">
<p id="message"></p>

<script>
var board = [
	[0, 0, 0],
	[0, 0, 0],
	[0, 0, 0],
];

var HUMAN = -1;
var COMP = +1;
var DIFFICULTY = 'hard';

function changeDifficulty(selectObj) {
	DIFFICULTY = selectObj.value;
}

function evalute(state) {
	var score = 0;
	if (gameOver(state, COMP)) score = +1;
	else if (gameOver(state, HUMAN)) score = -1;
	return score;
}

function gameOver(state, player) {
	var win_state = [
		[state[0][0], state[0][1], state[0][2]],
		[state[1][0], state[1][1], state[1][2]],
		[state[2][0], state[2][1], state[2][2]],
		[state[0][0], state[1][0], state[2][0]],
		[state[0][1], state[1][1], state[2][1]],
		[state[0][2], state[1][2], state[2][2]],
		[state[0][0], state[1][1], state[2][2]],
		[state[2][0], state[1][1], state[0][2]],
	];

	for (var i = 0; i < 8; i++) {
		var line = win_state[i];
		if (line.every(cell => cell == player)) return true;
	}
	return false;
}

function gameOverAll(state) {
	return gameOver(state, HUMAN) || gameOver(state, COMP);
}

function emptyCells(state) {
	var cells = [];
	for (var x = 0; x < 3; x++) {
		for (var y = 0; y < 3; y++) {
			if (state[x][y] == 0)
				cells.push([x, y]);
		}
	}
	return cells;
}

function validMove(x, y) {
	return board[x][y] == 0;
}

function setMove(x, y, player) {
	if (validMove(x, y)) {
		board[x][y] = player;
		return true;
	}
	return false;
}

function minimax(state, depth, player) {
	var best = (player == COMP) ? [-1, -1, -Infinity] : [-1, -1, Infinity];

	if (depth == 0 || gameOverAll(state)) {
		var score = evalute(state);
		return [-1, -1, score];
	}

	emptyCells(state).forEach(cell => {
		let x = cell[0], y = cell[1];
		state[x][y] = player;
		let score = minimax(state, depth - 1, -player);
		state[x][y] = 0;
		score[0] = x;
		score[1] = y;

		if (player == COMP && score[2] > best[2]) best = score;
		if (player == HUMAN && score[2] < best[2]) best = score;
	});

	return best;
}

function aiTurn() {
	var x, y, move;
	if (emptyCells(board).length == 9) {
		x = Math.floor(Math.random() * 3);
		y = Math.floor(Math.random() * 3);
	} else {
		if (DIFFICULTY === 'easy') {
			let cells = emptyCells(board);
			[x, y] = cells[Math.floor(Math.random() * cells.length)];
		} else if (DIFFICULTY === 'medium') {
			if (Math.random() < 0.5) {
				let cells = emptyCells(board);
				[x, y] = cells[Math.floor(Math.random() * cells.length)];
			} else {
				move = minimax(board, emptyCells(board).length, COMP);
				x = move[0]; y = move[1];
			}
		} else {
			move = minimax(board, emptyCells(board).length, COMP);
			x = move[0]; y = move[1];
		}
	}

	if (setMove(x, y, COMP)) {
		document.getElementById("" + x + y).innerHTML = "O";
		checkResult();
	}
}

function clickedCell(cell) {
	if (gameOverAll(board) || emptyCells(board).length === 0) return;

	let x = parseInt(cell.id[0]), y = parseInt(cell.id[1]);
	if (setMove(x, y, HUMAN)) {
		cell.innerHTML = "X";
		checkResult();
		if (!gameOverAll(board) && emptyCells(board).length > 0) {
			setTimeout(aiTurn, 300); // delay for realism
		}
	}
}

function checkResult() {
	let msg = document.getElementById("message");
	if (gameOver(board, HUMAN)) {
		msg.innerHTML = "You Win!";
	} else if (gameOver(board, COMP)) {
		msg.innerHTML = "You Lose!";
	} else if (emptyCells(board).length == 0) {
		msg.innerHTML = "Draw!";
	}
}

function restartBnt(button) {
	if (button.value == "Start AI" || button.value == "Restart") {
		board = [[0,0,0],[0,0,0],[0,0,0]];
		document.querySelectorAll("td").forEach(td => {
			td.innerHTML = "";
			td.style.color = "#000";
		});
		document.getElementById("message").innerHTML = "";
		button.value = "Restart";
		if (button.value == "Restart" && DIFFICULTY !== 'easy') {
			setTimeout(aiTurn, 300); // Let AI start if needed
		}
	}
}
</script>
</body>
</html>
